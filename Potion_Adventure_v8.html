<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ–‡å­—é­”è—¥åº— ï½œ æ°´å½©æ‰‹ç¹ªé¢¨å–®é å°éŠæˆ²</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&display=swap" rel="stylesheet');
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Chiron GoRound TC', sans-serif;
    background: linear-gradient(135deg, #f9f0e8 0%, #e8f0f5 100%);
    color: #c27f4f;
    min-height: 100vh;
    overflow: hidden;
    position: relative;
  }
  body::before {
    content: "";
    position: absolute;
    inset: 0;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><defs><filter id="watercolor"><feTurbulence type="fractalNoise" baseFrequency="0.03" numOctaves="4"/><feDiffuseLighting lighting-color="%23fff" surfaceScale="4"><feDistantLight azimuth="45" elevation="60"/></feDiffuseLighting><feComponentTransfer><feFuncA type="linear" slope="0.3"/></feComponentTransfer></filter></defs><rect width="100" height="100" fill="%23fff8f0" filter="url(%23watercolor)"/></svg>') repeat;
    opacity: 0.4;
    pointer-events: none;
  }
  
  .container { max-width: 1100px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
  header {
    text-align: center; margin-bottom: 20px; background: rgba(255,255,255,0.7);
    border-radius: 20px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  }
  h1 {
    font-family: 'Chiron GoRound TC', serif; font-size: 3.5em; color: #85522d;
    text-shadow: 2px 2px 8px rgba(142,36,170,0.2);
  }
  h1::after { content: " é­”è—¥å°èˆ– "; display: block; font-size: 0.4em; color: #666; margin-top: 8px; }
  
  .game-area { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px; }
  .panel {
    background: rgba(255,255,255,0.85); border-radius: 20px; padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15); backdrop-filter: blur(5px);
    border: 1px solid rgba(255,255,255,0.6);
  }
  .panel h2 {
    font-family: 'Chiron GoRound TC', serif; color: #6d4c41; margin-bottom: 15px;
    text-align: center; font-size: 1.8em;
  }
  .panel h3 { font-size: 1.2em; color: #8d6e63; margin: 15px 0 10px 0; }
  
  button {
    background: linear-gradient(to bottom, #ffecb3, #ffb74d); border: none;
    padding: 10px 16px; border-radius: 30px; font-weight: bold; cursor: pointer;
    box-shadow: 0 4px 10px rgba(255,152,0,0.3); transition: all 0.3s; margin: 4px;
  }
  button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255,152,0,0.4); }
  button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  
  #log {
    height: 280px; overflow-y: auto; background: rgba(255,248,240,0.9);
    padding: 15px; border-radius: 15px; font-family: 'Chiron GoRound TC', serif;
    line-height: 1.8; border: 2px dashed #ffab91;
  }
  .log-entry {
    margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dotted #ffccbc;
    opacity: 0; animation: fadein 1s forwards;
  }
  @keyframes fadein { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:none;} }
  
  .inventory { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-top: 10px; }
  .item {
    background: rgba(200,230,255,0.4); padding: 8px; border-radius: 12px;
    text-align: center; font-size: 0.9em; border: 1px solid #90caf9;
  }
  .potions { display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; margin-top: 10px; }
  .potion { background: rgba(255,200,230,0.5); border: 1px solid #f48fb1; }
  
  #cauldron {
    width: 100%; height: 180px; background: #424242; border-radius: 50% / 20%;
    position: relative; overflow: hidden; margin: 20px 0;
  }
  #cauldron::before {
    content: ""; position: absolute; inset: 15px;
    background: linear-gradient(to bottom, #97d171, #344728);
    border-radius: 50% / 20%; animation: bubble 6s infinite;
  }
  @keyframes bubble { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  
  .gold { color: #ff8f00; font-weight: bold; }
  .recipe-list { font-size: 0.85em; line-height: 1.5; max-height: 120px; overflow-y: auto; }
  .save-status { font-size: 0.9em; color: #4caf50; margin-top: 10px; }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>æ–‡å­—é­”è—¥åº—</h1>
    <div style="margin-top:15px;">
      <span style="margin:0 20px;">é‡‘å¹£ï¼š<span id="gold" class="gold">50</span> G</span>
      <span style="margin:0 20px;">æ—¥æ•¸ï¼š<span id="day">1</span></span>
      <span style="margin:0 20px;">è²æœ›ï¼š<span id="fame">0</span> âœ¦</span>
    </div>
    <div>
      <button onclick="saveGame()">ğŸ’¾ æ‰‹å‹•å­˜æª”</button>
      <button onclick="loadGame()">ğŸ“‚ è®€å–å­˜æª”</button>
      <button onclick="clearSave()">ğŸ—‘ï¸ æ¸…é™¤å­˜æª”</button>
      <span id="saveStatus" class="save-status" style="display:none;">å·²è‡ªå‹•å­˜æª”ï¼</span>
    </div>
  </header>

  <div class="game-area">
    <!-- å·¦ï¼šé‡å¤–æ¢ç´¢ -->
    <div class="panel">
      <h2>é‡å¤–æ¡é›† âœ¿</h2>
      <p>ä»Šå¤©è¦å»å“ªè£¡æ¢éšªå‘¢ï¼Ÿ</p>
      <button onclick="explore('forest')">ğŸŒ² ç¿ ç¶ æ£®æ—</button>
      <button onclick="explore('cave')">â›°ï¸ å¹½æš—ç¤¦å±±</button>
      <button onclick="explore('lake')">ğŸŒŠ å¯§éœæ¹–ç•”</button>
      <button onclick="explore('meadow')">ğŸŒ¼ èŠ±è‰å¹³åŸ</button>
      
      <h3>èƒŒåŒ…</h3>
      <div id="inventory" class="inventory"></div>
    </div>

    <!-- ä¸­ï¼šéŠé‡‘é‹çˆ -->
    <div class="panel">
      <h2>éŠé‡‘é‹çˆ âœ¨</h2>
      <div id="cauldron"></div>
      <p>æŠŠç´ ææ‹–é€²é‹è£¡è©¦è©¦çœ‹å§ï¼</p>
      <button onclick="brew()">é–‹å§‹ç†¬ç…®</button>
      <button onclick="clearCauldron()">æ¸…ç©ºé‹å­</button>
      
      <h3>å·²çŸ¥é…æ–¹</h3>
      <div id="recipes" class="recipe-list"></div>
      
      <h3>è—¥æ°´åº«å­˜</h3>
      <div id="potionsList" class="potions"></div>
    </div>

    <!-- å³ï¼šåº—èˆ–ç¶“ç‡Ÿ & æ—¥èªŒ -->
    <div class="panel">
      <h2>ä»Šæ—¥å§”è¨—</h2>
      <div id="quest"></div>
      <button onclick="nextDay()">ğŸŒ… è¿æ¥æ–°çš„ä¸€å¤©</button>
      
      <h2>å†’éšªæ—¥èªŒ</h2>
      <div id="log"></div>
    </div>
  </div>
</div>

<script>
// éŠæˆ²è³‡æ–™
let game = {
  gold: 50,
  day: 1,
  fame: 0,
  inventory: {},
  cauldron: [],
  potions: {}
};

const materials = {
  forest: ["æœˆå…‰è‰","è—ç²¾éˆè‡","ç™’åˆèŠ±ç“£","æ¯’æ²¼è˜‘è‡"],
  cave: ["ç´…ç¤¦æ™¶","ç´«æ°´æ™¶","è¢å…‰çŸ³","è™è ç¿…è†€"],
  lake: ["æ˜Ÿéœ²æ°´","äººé­šé±—ç‰‡","æ°´è“®","ç«èœ¥èœ´å°¾"],
  meadow: ["ç¨è§’ç¸æ¯›","é¾æ¯è‰","å½©è™¹èŠ±","å¹¸é‹å››è‘‰è‰"]
};

const recipesData = {
  "è—ç²¾éˆè‡æœˆå…‰è‰": {name:"å°æ²»ç™‚è—¥æ°´", price:30, ingredients: ["è—ç²¾éˆè‡", "æœˆå…‰è‰"]},
  "ç«èœ¥èœ´å°¾ç´…ç¤¦æ™¶": {name:"ç«ç„°è—¥æ°´", price:60, ingredients: ["ç«èœ¥èœ´å°¾", "ç´…ç¤¦æ™¶"]},
  "æ˜Ÿéœ²æ°´ç¨è§’ç¸æ¯›": {name:"å¹¸é‹è—¥æ°´", price:120, ingredients: ["æ˜Ÿéœ²æ°´", "ç¨è§’ç¸æ¯›"]},
  "ç´«æ°´æ™¶é¾æ¯è‰": {name:"éš±å½¢è—¥æ°´", price:200, ingredients: ["ç´«æ°´æ™¶", "é¾æ¯è‰"]},
  "æ°´è“®å¹¸é‹å››è‘‰è‰": {name:"é€Ÿåº¦è—¥æ°´", price:80, ingredients: ["æ°´è“®", "å¹¸é‹å››è‘‰è‰"]},
  "ç«èœ¥èœ´å°¾ç™’åˆèŠ±ç“£": {name:"åŠ›é‡è—¥æ°´", price:100, ingredients: ["ç«èœ¥èœ´å°¾", "ç™’åˆèŠ±ç“£"]},
  "æ¯’æ²¼è˜‘è‡è™è ç¿…è†€": {name:"æ¯’è—¥", price:50, ingredients: ["æ¯’æ²¼è˜‘è‡", "è™è ç¿…è†€"]},
  "äººé­šé±—ç‰‡è¢å…‰çŸ³": {name:"è§£æ¯’è—¥", price:70, ingredients: ["äººé­šé±—ç‰‡", "è¢å…‰çŸ³"]},
  "å½©è™¹èŠ±é¾æ¯è‰": {name:"æ„›æƒ…è—¥æ°´", price:150, ingredients: ["å½©è™¹èŠ±", "é¾æ¯è‰"]}
};

// === è±å¯Œçš„æ•…äº‹æ–‡å­— ===
const exploreStories = {
  forest: [
    "é™½å…‰å¾æ¨¹è‘‰ç¸«éš™ç‘ä¸‹ï¼Œä½ ç™¼ç¾ä¸€æ ªé–ƒè‘—éŠ€å…‰çš„æœˆå…‰è‰ï¼",
    "å°å…”å­å¸¶è·¯ï¼Œé ˜ä½ æ‰¾åˆ°è—åœ¨æ¨¹æ ¹ä¸‹çš„è—ç²¾éˆè‡ï½",
    "ä¸€éš»æ¨¹ç²¾å°ä½ çœ¨çœ¼ï¼Œé€çµ¦ä½ ä¸€ç‰‡ç™’åˆèŠ±ç“£ä½œç‚ºè¬ç¦®ã€‚",
    "å·®é»è¸©åˆ°æ¯’æ²¼è˜‘è‡ï¼å¹¸å¥½åŠæ™‚è·³é–‹ï¼Œé‚„æ˜¯æ‘˜äº†ä¸‹ä¾†ã€‚",
    "è½è¦‹é è™•æœ‰å°ç²¾éˆåœ¨å”±æ­Œï¼Œå¿ƒæƒ…è®Šå¾—å¥½æ£’ï¼",
    "é¢¨å¹éï¼Œæ¨¹è‘‰æ²™æ²™ä½œéŸ¿ï¼Œä½ è¼•è¼•å“¼è‘—æ­Œæ¡äº†${item}ã€‚"
  ],
  cave: [
    "é ­ç‡ˆç…§åˆ°ç‰†ä¸Šé–ƒäº®çš„ç´…ç¤¦æ™¶ï¼Œå¥½æ¼‚äº®ï¼",
    "è™è å¾é ­é ‚é£›éï¼Œä½ é‚„æ˜¯å‹‡æ•¢åœ°æ•²ä¸‹ç´«æ°´æ™¶ã€‚",
    "è¢å…‰çŸ³åƒæ˜Ÿæ˜Ÿä¸€æ¨£ç™¼å…‰ï¼ŒæŠŠæ•´å€‹æ´çªŸç…§å¾—å¤¢å¹»æ¥µäº†ï½",
    "è½è¦‹æ»´æ°´è²ï¼Œå¾ªè²æ‰¾åˆ°ä¸€å°ç‰‡è™è ç¿…è†€ã€‚",
    "æ´çªŸæ·±è™•æœ‰å¾®å¼±çš„å…‰ï¼ŒæŒ–é–‹å¾Œç«Ÿç„¶æ˜¯${item}ï¼",
    "ç¤¦è»Šå±å±ä½œéŸ¿ï¼Œä½ é–‹å¿ƒåœ°æŠŠ${item}è£é€²èƒŒåŒ…ã€‚"
  ],
  lake: [
    "æ¹–é¢åƒé¡å­ä¸€æ¨£å¹³éœï¼Œæ°´è“®åœ¨å¾®é¢¨ä¸­æ–æ›³ã€‚",
    "ä¸€å°¾äººé­šå¾æ°´é¢æ¢é ­ï¼Œå°ä½ ç¬‘äº†ç¬‘ï¼Œé€ä¸Šé–ƒäº®çš„é±—ç‰‡ï¼",
    "ç«èœ¥èœ´åœ¨å²¸é‚Šæ›¬å¤ªé™½ï¼Œä½ è¼•æ‰‹è¼•è…³åœ°æ‹¿èµ°å®ƒçš„å°¾å·´å°–ã€‚",
    "æ’ˆèµ·ä¸€ç“¶æ¸…æ¾ˆçš„æ˜Ÿéœ²æ°´ï¼Œè£¡é¢å¥½åƒæœ‰å°æ˜Ÿæ˜Ÿåœ¨æ¸¸ï½",
    "æ¹–é‚Šé–‹æ»¿äº†æ°´è“®ï¼Œä½ æŒ‘äº†æœ€æ¼‚äº®çš„é‚£æœµã€‚",
    "å¤•é™½æŠŠæ¹–æ°´æŸ“æˆç²‰æ©˜è‰²ï¼Œä½ å¸¶è‘—${item}æ»¿è¶³åœ°å›å®¶ã€‚"
  ],
  meadow: [
    "ä¸€éš»ç¨è§’ç¸å¾é è™•è·‘éï¼Œç•™ä¸‹ä¸€æ’®é–ƒäº®çš„æ¯›ï¼",
    "å½©è™¹èŠ±åœ¨é™½å…‰ä¸‹æ›äº†ä¸ƒç¨®é¡è‰²ï¼Œå¥½ç¥å¥‡ï¼",
    "é¢¨å¹éè‰åŸï¼Œå››è‘‰è‰åœ¨è…³é‚Šè·³èˆï¼Œä½ æ’¿èµ·ä¸€æ ªå¹¸é‹çš„ã€‚",
    "é¾æ¯è‰æ•£ç™¼æ·¡æ·¡çš„ç…™éœ§ï¼Œåƒå°é¾åœ¨æ‰“å™´åšä¸€æ¨£å¯æ„›ã€‚",
    "èººåœ¨è‰åœ°ä¸Šçœ‹é›²æœµï¼Œé†’ä¾†æ™‚ç™¼ç¾èº«é‚Šå¤šäº†${item}ã€‚",
    "è´è¶åœè‘—ä½ é£›èˆï¼Œæœ€å¾Œåœåœ¨${item}ä¸Šï¼Œåƒæ˜¯é€çµ¦ä½ çš„ç¦®ç‰©ã€‚"
  ]
};

const brewSuccess = {
  "å°æ²»ç™‚è—¥æ°´": ["è—¥æ°´æ•£ç™¼å‡ºæŸ”å’Œçš„ç¶ å…‰ï¼Œåƒæ£®æ—çš„å‘¼å¸ä¸€æ¨£æº«æš–ï½","ç“¶å­è£¡æœ‰å°ç²¾éˆåœ¨é£›èˆï¼Œæ²»ç™‚è—¥æ°´å®Œæˆå•¦ï¼","èèµ·ä¾†æœ‰é’è‰é¦™ï¼Œå–äº†è‚¯å®šå‚·å£ä¸€ç§’å°±å¥½ã€‚","é‹å­å’•åš•å’•åš•å¾Œï¼Œå†’å‡ºå¿ƒå½¢æ³¡æ³¡ï¼Œå¤ªå¯æ„›äº†ï¼"],
  "ç«ç„°è—¥æ°´": ["ç«ç„°åœ¨ç“¶ä¸­è·³èˆï¼Œåƒé—œè‘—ä¸€éš»å°ç«é¾ï¼","å¥½ç†±å¥½ç†±ï¼å°å¿ƒæ‹¿å“¦ï¼Œå¨åŠ›è¶…å¼·çš„ç«ç„°è—¥æ°´èª•ç”Ÿï¼","ç“¶èº«è®Šå¾—æš–å‘¼å‘¼ï¼Œæ‹¿åœ¨æ‰‹ä¸ŠåƒæŠ±è‘—å°å¤ªé™½ã€‚","æœ€å¾Œä¸€ç§’é‚„å™´å‡ºå°ç«èŠ±ï¼Œå¸¥æ°£æ¥µäº†ï¼"],
  "å¹¸é‹è—¥æ°´": ["ç“¶è£¡çš„æ¶²é«”åƒå½©è™¹ä¸€æ¨£è½‰åœˆåœˆï¼Œå–äº†è‚¯å®šå¥½é‹çˆ†æ£šï¼","æœ‰é‡‘å…‰é–ƒé–ƒçš„å°æ˜Ÿæ˜Ÿåœ¨è£¡é¢æ¸¸ä¾†æ¸¸å»ï½","æ–ä¸€æ–æœƒç™¼å‡ºå®å®å™¹å™¹çš„å¹¸é‹è²éŸ³ï¼","ç¨è§’ç¸åœ¨å¤¢è£¡å°ä½ å¾®ç¬‘ï¼Œå¹¸é‹è—¥æ°´å®Œæˆï¼"],
  "éš±å½¢è—¥æ°´": ["è—¥æ°´æ¼¸æ¼¸è®Šé€æ˜ï¼Œé€£ç“¶å­éƒ½ä¸è¦‹äº†ï¼å¥½ç¥å¥‡ï¼","å–ä¸‹å»ä¸€å®šæœƒåƒé¢¨ä¸€æ¨£æ¶ˆå¤±ä¸è¦‹ï½","æœ€å¾Œä¸€æ»´è½å…¥ç“¶ä¸­ï¼Œæ•´å€‹é‹å­éƒ½éš±å½¢äº†ä¸‰ç§’ï¼","æ‹¿åœ¨æ‰‹ä¸Šæœƒå¿˜è¨˜å®ƒåœ¨å“ªè£¡ï¼Œè¶…å¥½ç©çš„éš±å½¢è—¥æ°´ï¼"],
  "é€Ÿåº¦è—¥æ°´": ["æ¶²é«”åƒé–ƒé›»ä¸€æ¨£æµå‹•ï¼Œå–äº†è…³æ­¥æœƒè®Šå¾—é£›å¿«ï¼","ç“¶å­å‘¨åœæœ‰å°é¢¨åœ¨æ—‹è½‰ï¼Œé€Ÿåº¦è—¥æ°´å¤§æˆåŠŸï½","å’•åš•ä¸€è²ï¼Œå†’å‡ºè—è‰²ç…™éœ§ï¼Œè¶…é€Ÿæ„Ÿæ»¿é»ï¼","æƒ³åƒå…”å­ä¸€æ¨£å¥”è·‘ï¼Œæˆå“å®Œç¾ï¼"],
  "åŠ›é‡è—¥æ°´": ["è‚Œè‚‰é¼“èµ·çš„ç´…è‰²å…‰èŠ’ï¼ŒåŠ›é‡çˆ†ç™¼å•¦ï¼","ç“¶å­è®Šå¾—æ²‰ç”¸ç”¸çš„ï¼Œè£¡é¢å……æ»¿äº†å·¨åŠ›ï½","ç«ç´…æ³¡æ³¡ç ´è£‚ï¼ŒåŠ›é‡è—¥æ°´é–ƒè€€èª•ç”Ÿï¼","ä¸€å–å°±èƒ½èˆ‰èµ·å¤§çŸ³é ­ï¼Œè¶…å¼·ï¼"],
  "æ¯’è—¥": ["ç¶ è‰²æ¯’éœ§ç€°æ¼«ï¼Œé€£ç“¶è“‹éƒ½å±å±ä½œéŸ¿â€¦å°å¿ƒï¼","è®Šæˆæœƒè •å‹•çš„æ¶²é«”ï¼Œæ¯’æ€§è¶…çŒ›çš„å‚‘ä½œï¼","å°éª·é«é ­æµ®ç¾ï¼Œæ¯’è—¥å®Œæˆï¼Œå£å£çš„æ„Ÿè¦ºï½","èèµ·ä¾†è¶…é…¸ï¼Œä¿è­‰ä¸€æ»´è¦‹æ•ˆï¼"],
  "è§£æ¯’è—¥": ["æ¸…æ¾ˆé‡‘å…‰é–ƒé–ƒï¼Œåƒé™½å…‰ä¸€æ¨£æº«æŸ”çš„è§£æ¯’åŠ‘ï¼","æ³¡æ³¡è®Šæˆå°ç›¾ç‰Œï¼Œå®Œç¾æŠµæ“‹ä¸€åˆ‡æ¯’ï¼","äººé­šåœ¨ç“¶ä¸­å¾®ç¬‘ï¼Œè§£æ¯’è—¥æ°´ç™‚ç™’å…¨å ´ï½","æœ€å¾Œä¸€æ³¡å†’å‡ºèŠ±æœµï¼Œè¶…æ²»ç™’ï¼"],
  "æ„›æƒ…è—¥æ°´": ["ç²‰ç´…å¿ƒå¿ƒæ³¡æ³¡äº‚é£›ï¼Œæ„›æƒ…è—¥æ°´å¤ªæµªæ¼«äº†ï¼","ç“¶å­æ•£ç™¼ç«ç‘°é¦™ï¼Œå–äº†æœƒå¢œå…¥æ„›æ²³ï½","å½©è™¹èˆ‡å¿ƒå½¢äº¤ç¹”ï¼Œç”œèœœæ»¿åˆ†ï¼","å°ä¸˜æ¯”ç‰¹çœ¨çœ¼ï¼Œæ„›æƒ…ä¹‹åŠ›è¦ºé†’ï¼"]
};

const brewFail = [
  "è®Šæˆä¸€åœ˜ç´«è‰²é»é»çš„æ³¥å·´ï¼Œé‚„å°ä½ åèˆŒé ­â€¦",
  "ç™¼å‡ºè¶…ç´šè‡­çš„å‘³é“ï¼çª—å¤–çš„è²“é ­é·¹éƒ½é£›èµ°äº†ï¼",
  "è½Ÿï¼é‹å­å°çˆ†ç‚¸ï¼Œæ»¿å±‹å­å½©è‰²ç…™éœ§ä¸‰å¤©æ‰æ•£ã€‚",
  "è®Šæˆæœƒè·³çš„é’è›™æœå‡ï¼Œè¹¦è¹¦è·³è·³é€ƒå‡ºçª—å¤–â€¦",
  "å†’å‡ºä¸€å †å°æ³¡æ³¡ï¼Œæ¯å€‹æ³¡æ³¡éƒ½åœ¨èªªã€Œå¤±æ•—å•¦ï½ã€",
  "æ•´é‹è®Šæˆé»‘è‰²ï¼Œé‚„é•·å‡ºå°è§¸æ‰‹å°ä½ æ®æ‰‹ï¼",
  "çªç„¶å”±èµ·èµ°èª¿çš„æ­Œï¼Œå”±å®Œå°±æ¶ˆå¤±äº†â€¦",
  "è®Šæˆä¸€ç˜å½©è™¹è‰²æ°´æ¼¬ï¼Œåœ¨åœ°æ¿ä¸Šç•«äº†å€‹ç¬‘è‡‰ã€‚"
];

const questSuccess = [
  "å†’éšªè€…å–ä¸‹è—¥æ°´ï¼Œå‚·å£ç¬é–“ç™’åˆï¼Œå°ä½ æ·±æ·±ä¸€é èº¬ï¼",
  "å®¢äººé–‹å¿ƒåˆ°è½‰åœˆåœˆï¼Œé‚„å¤šçµ¦äº†ä½ 10æšé‡‘å¹£å°è²»ï½",
  "è²´æ—å°å§èªªé€™æ˜¯å¥¹å–éæœ€æ£’çš„è—¥æ°´ï¼Œè²æœ›ä¸Šå‡å•¦ï¼",
  "ç›œè³Šå·å·å°ä½ æ¯”äº†å€‹è®šï¼Œç„¶å¾Œå¸¥æ°£åœ°æ¶ˆå¤±åœ¨å¤œè‰²ä¸­ã€‚",
  "æ³•å¸«å¤§è®šä½ çš„æ‰‹è—ï¼Œç­”æ‡‰ä¸‹æ¬¡ä»‹ç´¹æœ‹å‹ä¾†ï¼",
  "åŠå£«æ®èˆæ­¦å™¨è©¦æ•ˆï¼Œèˆˆå¥®åœ°èªªè¦å¤©å¤©ä¾†è²·ï¼"
];

const newDayStories = [
  "é™½å…‰å¾çª—æˆ¶ç‘é€²ä¾†ï¼Œé–€å£çš„é¢¨éˆ´å®å®å™¹å™¹éŸ¿è‘—è¿æ¥æ–°çš„ä¸€å¤©ã€‚",
  "è²“é ­é·¹å¸¶è‘—ä¸€å°æ–°çš„å§”è¨—ä¿¡é£›ä¾†ï¼Œæ–°çš„å†’éšªé–‹å§‹å•¦ï¼",
  "åº—é–€å£é–‹äº†ä¸€æœµå¾æ²’çœ‹éçš„å°èŠ±ï¼Œå¥½åƒåœ¨è·Ÿä½ èªªæ—©å®‰ã€‚",
  "çƒ¤éºµåŒ…çš„é¦™å‘³é£„é€²å±‹å…§ï¼Œä»Šå¤©ä¹Ÿæœƒæ˜¯ç¾å¥½çš„ä¸€å¤©ï½",
  "å°ç²¾éˆåœ¨çª—è‡ºè·³èˆï¼Œç‘ä¸‹é–ƒäº®çš„å…‰ç²‰ç‚ºä½ åŠ æ²¹ï¼",
  "é è™•å‚³ä¾†å†’éšªè€…å€‘çš„ç¬‘è²ï¼Œåˆæ˜¯å……æ»¿å¸Œæœ›çš„ä¸€å¤©ï¼"
];

const materialStories = {
  "æœˆå…‰è‰": [
    "æœˆå…‰è‰çš„è‘‰é¢é–ƒè‘—éŠ€è‰²å…‰ç—•ï¼Œåƒæ˜¯æœˆç¥ç•™ä¸‹çš„ç­†è·¡ã€‚",
    "ä½ å½ä¸‹è…°æ™‚ï¼Œæœˆå…‰è‰æ–æ›³äº†ä¸€ä¸‹ï¼Œåƒæ˜¯åœ¨æé†’ä½ æŠŠå®ƒå¸¶èµ°ã€‚"
  ],
  "è—ç²¾éˆè‡": [
    "è—ç²¾éˆè‡å†’å‡ºæ·¡æ·¡å…‰æšˆï¼Œå½·å½¿æ­£æ‚„æ‚„å‘¼å¸ã€‚",
    "ä½ ç¢°åˆ°çš„ç¬é–“ï¼Œè—ç²¾éˆè‡çŸ­çŸ­äº®äº†ä¸€ä¸‹ï¼Œå¥½åƒè¢«åš‡åˆ°çš„å°ç”Ÿç‰©ã€‚"
  ],
  "ç™’åˆèŠ±ç“£": [
    "èŠ±ç“£æ•£ç™¼è‘—æŸ”è»Ÿæš–æ„ï¼Œä½ çš„æ‰‹æŒ‡è¢«æº«æŸ”åŒ…è¦†äº†ä¸€ä¸‹ã€‚",
    "è¼•è§¸å®ƒæ™‚ï¼Œå¾®å…‰å¾èŠ±å¿ƒç¶»é–‹ï¼Œåƒæ˜¯åœ¨ç¤ºæ„ä½ å¸¶èµ°å®ƒçš„åŠ›é‡ã€‚"
  ],
  "æ¯’æ²¼è˜‘è‡": [
    "æ¯’æ²¼è˜‘è‡æ–æ™ƒè‘—ï¼Œæ•£å‡ºä¸€è‚¡å¥‡å¦™çš„é…¸ç”œæ°£å‘³ã€‚",
    "ä½ å°å¿ƒæ‘˜èµ·æ™‚ï¼Œå®ƒåƒæ˜¯ã€Œå•µã€åœ°å«äº†ä¸€è²ã€‚"
  ],

  "ç´…ç¤¦æ™¶": [
    "ç´…ç¤¦æ™¶åœ¨æš—è™•å»ç™¼å‡ºå¼·çƒˆå…‰èŠ’ï¼Œåƒè—è‘—å°ç«ç„°ã€‚",
    "ä½ æ•²ä¸‹å®ƒæ™‚ï¼Œç¤¦æ™¶é‚Šç·£å†’å‡ºä¸€çµ²ç†±æ°£ã€‚"
  ],
  "ç´«æ°´æ™¶": [
    "ç´«æ°´æ™¶æŠ˜å°„å‡ºæº«æŸ”å…‰ç·šï¼Œåƒå¤œç©ºçš„ä¸€è§’æ‰è½ã€‚",
    "å²©å£éœ‡å‹•äº†ä¸€ä¸‹ï¼Œç´«æ°´æ™¶åƒé †å¾åœ°æ»‘å…¥ä½ æ‰‹å¿ƒã€‚"
  ],
  "è¢å…‰çŸ³": [
    "è¢å…‰çŸ³çš„æŸ”å…‰ç…§äº®ä½ çš„æŒ‡å°–ï¼Œåƒåœ¨å‘ä½ æ’’æ­¡ã€‚",
    "å®ƒå®‰éœåˆæº«æš–ï¼Œå½·å½¿å–œæ­¡è¢«ä½ æ¡è‘—ã€‚"
  ],
  "è™è ç¿…è†€": [
    "ç¿…è†€é‚Šç·£ä»æœ‰å¾®å¾®çš„é­”åŠ›è·³å‹•ã€‚",
    "ä½ æ‹¿èµ·æ™‚ï¼Œå½·å½¿è½è¦‹é è™•è™è çš„å°å°å•¼è²ã€‚"
  ],

  "æ˜Ÿéœ²æ°´": [
    "ç“¶ä¸­çš„éœ²æ°´æ˜ å‡ºå¾®å°æ˜Ÿå…‰ï¼Œåƒè£è‘—ä¸€ç‰‡å¤œç©ºã€‚",
    "éœ²æ°´åœ¨æ–æ™ƒæ™‚ç”¢ç”ŸéŠ€è‰²æ¼£æ¼ªï¼Œååˆ†ç¥ç§˜ã€‚"
  ],
  "äººé­šé±—ç‰‡": [
    "é±—ç‰‡åœ¨é™½å…‰ä¸‹é–ƒé–ƒç™¼äº®ï¼Œåƒæ˜¯æµ·æµªç¢è£‚çš„ç¬é–“ã€‚",
    "ä½ æ‹¿èµ·æ™‚ï¼Œå®ƒåƒæ˜¯è¼•è¼•éœ‡å‹•äº†ä¸€ä¸‹ã€‚"
  ],
  "æ°´è“®": [
    "æ°´è“®æ•£ç™¼æ·¡æ·¡é¦™æ°£ï¼Œåƒæ¹–é¢æ¸…æ™¨çš„ç©ºæ°£ã€‚",
    "ä½ æŠŠå®ƒå¾æ°´é¢æ‘˜ä¸‹æ™‚ï¼Œæ°´æ³¢è¼•æ‹ä½ çš„æ‰‹æŒ‡ã€‚"
  ],
  "ç«èœ¥èœ´å°¾": [
    "å°¾å·´å°¾ç«¯ä»æ®˜ç•™å¾®å¼±ç†±åº¦ï¼Œå°å¿ƒé»ã€‚",
    "ä½ ç¢°åˆ°æ™‚ï¼Œå®ƒè¼•è¼•å½ˆäº†ä¸€ä¸‹ï¼Œåƒåœ¨åæŠ—ã€‚"
  ],

  "ç¨è§’ç¸æ¯›": [
    "æŸ”è»Ÿç´°ç·»çš„æ¯›é«®ä¸Šé–ƒè‘—ç´”ç™½å…‰é»ï¼Œå¦‚å¤¢ä¼¼å¹»ã€‚",
    "æ¯›ç«¯å¸¶è‘—ä¸€è‚¡ç¥ç¦èˆ¬çš„æš–æ„ã€‚"
  ],
  "é¾æ¯è‰": [
    "é¾æ¯è‰æ•£å‡ºç´°ç´°ç…™éœ§ï¼Œåƒå°é¾çš„å‘¼å¸ã€‚",
    "ç…™éœ§ç¹šç¹ä½ çš„æŒ‡å°–ï¼Œè®“äººå¿ƒæƒ…è®Šå¾—ç¥ç¥•ã€‚"
  ],
  "å½©è™¹èŠ±": [
    "èŠ±ç“£éš¨å…‰ç·šè®Šæ›è‰²å½©ï¼Œç¾å¾—è®“äººæ¨ä¸å¾—æ‘˜ä¸‹ã€‚",
    "ä½ æ¡ä½æ™‚ï¼ŒèŠ±ç“£åƒåœ¨æ‰‹ä¸­è·³å‹•ã€‚"
  ],
  "å¹¸é‹å››è‘‰è‰": [
    "é€™ç‰‡å››è‘‰è‰æ¯”å…¶ä»–çš„æ›´ç¿ ç¶ ï¼Œåƒæ˜¯è‡ªå·±èµ°åˆ°ä½ æ‰‹é‚Šçš„ã€‚",
    "ä½ æ’¿èµ·å®ƒæ™‚ï¼Œå¾®é¢¨å‰›å¥½å¹éï¼Œå½·å½¿åœ¨ç¥ç¦ä½ ã€‚"
  ]
};

// === å­˜æª”åŠŸèƒ½ ===
function saveGame() {
  localStorage.setItem('potionShopSave', JSON.stringify(game));
  showSaveStatus('å·²æ‰‹å‹•å­˜æª”ï¼');
}

function loadGame() {
  const saved = localStorage.getItem('potionShopSave');
  if (saved) {
    game = JSON.parse(saved);
    updateAll();
    addLog('å¾å­˜æª”ä¸­å–šé†’äº†é­”è—¥åº—ï¼ä¸€åˆ‡å¦‚æ˜¨ï½');
    showSaveStatus('å·²è®€å–å­˜æª”ï¼');
  } else {
    addLog('æ²’æœ‰æ‰¾åˆ°å­˜æª”â€¦å¾é ­é–‹å§‹æ–°å†’éšªå§ï¼');
  }
}

function clearSave() {
  localStorage.removeItem('potionShopSave');
  addLog('å­˜æª”å·²æ¸…é™¤ï¼åº—èˆ–å›æ­¸æœ€åˆçš„æ¨¡æ¨£ï½');
  location.reload();
}

function showSaveStatus(msg) {
  const status = document.getElementById('saveStatus');
  status.textContent = msg;
  status.style.display = 'inline';
  setTimeout(() => status.style.display = 'none', 3000);
}

function autoSave() {
  saveGame();
}

// === å…¶ä»–å‡½å¼ ===
function addLog(text) {
  const log = document.getElementById('log');
  const entry = document.createElement('div');
  entry.className = 'log-entry';
  entry.innerHTML = `âœ ç¬¬${game.day}å¤©ãƒ»${text}`;
  log.prepend(entry);
  setTimeout(() => log.scrollTop = 0, 100);
}

function updateGold() { document.getElementById('gold').textContent = game.gold; }
function updateDay() { document.getElementById('day').textContent = game.day; }
function updateFame() { document.getElementById('fame').textContent = game.fame; }

function updateInventory() {
  const inv = document.getElementById('inventory');
  inv.innerHTML = '';
  let count = Object.values(game.inventory).reduce((a,b)=>a+b,0);
  if (count > 25) addLog("èƒŒåŒ…å¿«æ»¿äº†ï¼å¤šè³£é»è—¥æ°´æ›ç©ºé–“å§ï½");
  
  for (let item in game.inventory) {
    if (game.inventory[item] > 0) {
      const div = document.createElement('div');
      div.className = 'item';
      div.textContent = item + " Ã— " + game.inventory[item];
      div.draggable = true;
      div.ondragstart = e => e.dataTransfer.setData("text", item);
      inv.appendChild(div);
    }
  }
}

function updatePotions() {
  const list = document.getElementById('potionsList');
  list.innerHTML = '';
  for (let potion in game.potions) {
    if (game.potions[potion] > 0) {
      const div = document.createElement('div');
      div.className = 'potion item';
      div.textContent = potion + " Ã— " + game.potions[potion];
      list.appendChild(div);
    }
  }
}

function updateRecipes() {
  const rec = document.getElementById('recipes');
  rec.innerHTML = '';
  for (let key in recipesData) {
    const recipe = recipesData[key];
    const [mat1, mat2] = recipe.ingredients.sort(); // æŒ‰å­—æ¯é †åºé¡¯ç¤º
    rec.innerHTML += `â€¢ ${mat1} + ${mat2} â†’ ${recipe.name} (+${recipe.price}G)<br>`;
  }
}

function updateAll() {
  updateGold();
  updateDay();
  updateFame();
  updateInventory();
  updatePotions();
}

// æ‹–æ›³æ”¾å…¥é‹å­
document.getElementById('cauldron').ondragover = e => e.preventDefault();
document.getElementById('cauldron').ondrop = e => {
  e.preventDefault();
  const item = e.dataTransfer.getData("text");
  if (game.inventory[item] > 0) {
    game.inventory[item]--;
    if (game.inventory[item] === 0) delete game.inventory[item];
    game.cauldron.push(item);
    addLog(`æŠŠã€Œ${item}ã€è¼•è¼•ä¸Ÿé€²äº†é‹å­â€¦å’•åš•å’•åš•ï¼Œé–‹å§‹å†’æ³¡å›‰ï½`);
    updateInventory();
  }
};

function explore(area) {
  const names = {forest: "ç¿ ç¶ æ£®æ—", cave: "å¹½æš—ç¤¦å±±", lake: "å¯§éœæ¹–ç•”", meadow: "èŠ±è‰å¹³åŸ"};
  const list = materials[area];
  const item = list[Math.floor(Math.random()*list.length)];
  game.inventory[item] = (game.inventory[item]||0) + 1;
  
   // 1. åŸæœ¬çš„åœ°é»æ•…äº‹
  let areaStories = exploreStories[area];
  let areaText = areaStories[Math.floor(Math.random()*areaStories.length)].replace(/\$\{item\}/g, item);

  // 2. æ–°å¢çš„ææ–™å°ˆå±¬æ•…äº‹ï¼ˆå…©å€‹å…¶ä¸­ä¹‹ä¸€ï¼‰
  let matStories = materialStories[item] || [];
  let matText = "";
  if (matStories.length > 0) {
    matText = matStories[Math.floor(Math.random()*matStories.length)];
  }
  // 3. åˆä½µæˆåŒä¸€å‰‡æ—¥èªŒï¼ˆä¸ç ´å£ç¾æœ‰æ ¼å¼ï¼‰
  let finalText = areaText;
  if (matText) finalText += " " + matText;

  addLog(finalText);
  updateInventory();
}

function brew() {
  if (game.cauldron.length < 2) {
    addLog("é‹å­è£¡çš„ç´ æå¤ªå°‘ï¼Œåªè½åˆ°å¯‚å¯çš„å’•åš•è²â€¦");
    return;
  }
  // æŒ‰å­—æ¯é †åºæ’åºç´ æï¼Œå¿½ç•¥æŠ•å…¥é †åº
  const key = game.cauldron.sort().join("");
  if (recipesData[key]) {
    const potion = recipesData[key];
    game.potions[potion.name] = (game.potions[potion.name]||0) + 1;
    const lines = brewSuccess[potion.name] || ["ç¥ç§˜è—¥æ°´èª•ç”Ÿäº†ï¼æ•ˆæœæœªçŸ¥ä½†è¶…æ¼‚äº®ï½"];
    addLog(lines[Math.floor(Math.random()*lines.length)]);
    updatePotions();
  } else {
    addLog(brewFail[Math.floor(Math.random()*brewFail.length)]);
    game.gold = Math.max(0, game.gold - 10);
    updateGold();
  }
  game.cauldron = [];
}

function clearCauldron() {
  if (game.cauldron.length === 0) {
    addLog("é‹å­å·²ç¶“ç©ºç©ºçš„å•¦ï½åƒæ–°çš„ä¸€æ¨£ä¹¾æ·¨ï¼");
  } else {
    game.cauldron = [];
    addLog("æŠŠé‹å­è£¡çš„æ±è¥¿å…¨éƒ¨å€’å›å¤§è‡ªç„¶â€¦å°é­šèªªè¬è¬ä½ å“¦ï½");
  }
}

function generateQuest() {
  const quests = [
    {text:"å¹´è¼•åŠå£«å—å‚·äº†ï¼Œéœ€è¦æ²»ç™‚è—¥æ°´", need:"å°æ²»ç™‚è—¥æ°´", reward:40},
    {text:"è€æ³•å¸«è¦å°ä»˜å†°é¾ï¼Œæƒ³è¦ç«ç„°è—¥æ°´", need:"ç«ç„°è—¥æ°´", reward:80},
    {text:"å°å·å…¬æœƒåœ¨æ‰¾éš±å½¢è—¥æ°´", need:"éš±å½¢è—¥æ°´", reward:250},
    {text:"è²´æ—å°å§æ˜å¤©è¦åƒåŠ èˆæœƒï¼Œæƒ³è¦å¹¸é‹è—¥æ°´", need:"å¹¸é‹è—¥æ°´", reward:150},
    {text:"ç›œè³Šéœ€è¦é€Ÿåº¦è—¥æ°´é€ƒè·‘", need:"é€Ÿåº¦è—¥æ°´", reward:90},
    {text:"å¤§åŠ›å£«è¦åŠ›é‡è—¥æ°´æŒ‘æˆ°å·¨ç¸", need:"åŠ›é‡è—¥æ°´", reward:120},
    {text:"åˆºå®¢å…¬æœƒè¨‚è³¼æ¯’è—¥", need:"æ¯’è—¥", reward:60},
    {text:"ä¸­æ¯’çš„é¨å£«æ€¥éœ€è§£æ¯’è—¥", need:"è§£æ¯’è—¥", reward:85},
    {text:"æˆ€æ„›ä¸­çš„ç²¾éˆè¦æ„›æƒ…è—¥æ°´", need:"æ„›æƒ…è—¥æ°´", reward:180}
  ];
  const q = quests[Math.floor(Math.random()*quests.length)];
  document.getElementById('quest').innerHTML = `
    <p><strong>${q.text}</strong><br>
    è¦æ±‚ï¼š${q.need} Ã—1<br>
    å ±é…¬ï¼š${q.reward} G</p>
    <button onclick="completeQuest('${q.need}',${q.reward})">äº¤ä»˜è—¥æ°´</button>
  `;
}

function completeQuest(potion, reward) {
  if ((game.potions[potion]||0) > 0) {
    game.potions[potion]--;
    game.gold += reward;
    game.fame += 1;
    addLog(questSuccess[Math.floor(Math.random()*questSuccess.length)]);
    updateGold(); 
    updateFame();
    updatePotions();
  } else {
    addLog("å“å‘€â€¦é‚„æ²’æœ‰åšå‡ºå®¢äººè¦çš„è—¥æ°´å‘¢ï¼Œæ˜å¤©è¦åŠ ç·Šç…®å“¦ï¼");
  }
  generateQuest();
}

function nextDay() {
  game.day++;
  addLog(newDayStories[Math.floor(Math.random()*newDayStories.length)]);
  generateQuest();
  autoSave();
  updateDay();
}

// åˆå§‹åŒ–
function init() {
  const saved = localStorage.getItem('potionShopSave');
  if (saved) {
    if (confirm('ç™¼ç¾å­˜æª”ï¼æ˜¯å¦è®€å–ç¹¼çºŒéŠæˆ²ï¼Ÿï¼ˆå¦å‰‡å¾é ­é–‹å§‹ï¼‰')) {
      loadGame();
    } else {
      localStorage.removeItem('potionShopSave');
    }
  }
  updateRecipes();
  updateAll();
  generateQuest();
  addLog("ä»Šå¤©ä¹Ÿæœƒæœ‰æ–°çš„å†’éšªè€…ä¾†å§”è¨—å§â€¦åŠ æ²¹ï¼ä½ çš„é­”è—¥åº—è¶Šä¾†è¶Šç†±é¬§å›‰ï½");
  autoSave();
}
init();
</script>
</body>
</html>